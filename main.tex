%
% File acl2020.tex
%
%% Based on the style files for ACL 2020, which were
%% Based on the style files for ACL 2018, NAACL 2018/19, which were
%% Based on the style files for ACL-2015, with some improvements
%%  taken from the NAACL-2016 style
%% Based on the style files for ACL-2014, which were, in turn,
%% based on ACL-2013, ACL-2012, ACL-2011, ACL-2010, ACL-IJCNLP-2009,
%% EACL-2009, IJCNLP-2008...
%% Based on the style files for EACL 2006 by 
%%e.agirre@ehu.es or Sergi.Balari@uab.es
%% and that of ACL 08 by Joakim Nivre and Noah Smith

\documentclass[11pt,a4paper]{article}
\usepackage[hyperref]{acl2021}
\usepackage{times}
\usepackage{latexsym}
\usepackage{stfloats}

\renewcommand{\UrlFont}{\ttfamily\small}
\usepackage{amsmath,amsthm,amssymb}

% This is not strictly necessary, and may be commented out,
% but it will improve the layout of the manuscript,
% and will typically save some space.
\usepackage{microtype}
\usepackage{balance}
\usepackage{paralist}
\usepackage{verbatim}
\usepackage[normalem]{ulem}
\usepackage[vlined,ruled,linesnumbered]{algorithm2e}
\usepackage{makecell}
\usepackage{txfonts}
\usepackage{xspace}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{xcolor,colortbl}
\usepackage{color,soul}
\usepackage{multirow}

\usepackage[T1]{fontenc}
\usepackage{bbold}
\usepackage{pifont}% http://ctan.org/pkg/pifont


%\aclfinalcopy % Uncomment this line for the final submission
\def\aclpaperid{183} %  Enter the acl Paper ID here

%\setlength\titlebox{5cm}
% You can expand the titlebox if you need extra space
% to show all the authors. Please do not make the titlebox
% smaller than 5cm (the original size); we will check this
% in the camera-ready version and ask you to change it back.
\renewcommand{\ttdefault}{txtt}
\newcommand\BibTeX{B\textsc{ib}\TeX}
%\newcommand*{\emailfont}{\fontfamily{pcr}\selectfont}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\dist}{D_f}
\DeclareMathOperator*{\fp}{f_p}
\DeclareMathOperator*{\E}{\mathbf{H}}
\DeclareMathOperator*{\R}{r}
\newcommand{\relation}[1]{\R(#1)}

\setlength{\fboxsep}{0pt}

\newcommand{\colbox}[2]{\colorbox{#1}{#2}}

 
\newcommand{\veryshortarrow}[1][3pt]{\mathrel{%
   \hbox{\rule[\dimexpr\fontdimen22\textfont2-.2pt\relax]{#1}{.4pt}}%
   \mkern-4mu\hbox{\usefont{U}{lasy}{m}{n}\symbol{41}}}}
   
  
\definecolor{caddback}{rgb}{0.90, 0.98, 0.96}
\definecolor{cadd}{rgb}{0, 0.47, 0.34}
\definecolor{cdelback}{rgb}{1, 0.94, 0.92}
\definecolor{cdel}{rgb}{0.83, 0.32, 0.16}
\def \arrow{$\veryshortarrow$}
\newcommand{\add}[1]{\colbox{caddback}{\color{cadd}#1\xspace}} %
\newcommand{\addplus}[1]{{\footnotesize+}\add{#1}}


\newcommand{\remove}[1]{\colbox{cdelback}{{\color{cdel}#1\xspace}}}%
\newcommand{\swap}[2]{\remove{#1}~\arrow~\add{#2}}
\newcommand{\ctrltag}[1]{\texttt{#1}\xspace}
%\renewcommand{\add}[1]{{\color{cadd}#1\xspace}} %





\definecolor{cexample}{rgb}{0.23, 0.30, 0.45}
\newcommand{\exinline}[1]{{\color{cexample}``#1''\xspace}}
\newcommand{\fillin}[1]{{\color{cexample}#1\xspace}}

\newcommand{\fontsmall}{\fontsize{9pt}{11pt}\selectfont}
\newcommand{\fontnormal}{\fontsize{10pt}{12pt}\selectfont}
\fboxrule=0.1pt
\newcommand{\ebox}[1]{%
	%\smallskip
	\vspace{2pt}
	\noindent\fcolorbox{gray}{white}{
		\begin{minipage}{0.95\linewidth}
			\fontsmall
			%\begin{internallinenumbers}
			%\resetlinenumber
			{#1}
			%\end{internallinenumbers}
		\end{minipage}
	}
	\vspace{-2pt}
}

% [(0.166, 'opposing '), (0.099, 'team '), (0.027, 'by '), (0.026, 'quarterback '), (0.024, 'The '), (0.024, 'is '), (0.024, '. '), (0.023, ' '), (0.023, 'about '), (0.023, 'to '), (0.023, 'be '), (0.023, 'tackled '), (0.019, 'the '), (-0.0, ' ')]
%#eef5fa
%#daeaf5
%#c6deef
%#b2d2e9
%#9ec7e4
%#8abbde

\definecolor{ctemplate}{rgb}{0.23, 0.30, 0.45}
%\definecolor{ctemplate}{rgb}{0.23, 0.30, 0.45}
\definecolor{cword}{rgb}{0, 0, 0.7}
\newcommand{\BLANK}{\texttt{BLANK}}

% format
\newcommand{\clabel}[1]{\emph{#1}\xspace}

% constants
\newcommand{\sysname}{\textsc{Polyjuice}\xspace}
\newcommand{\modelurl}{\url{https://huggingface.co/uw-hai/polyjuice}}
\renewcommand{\modelurl}{\texttt{[URL omitted]}}

\newcommand{\mturkurl}{\url{https://tongshuangwu.github.io/perturb-exp-ui/?assignmentId=1&platform=standalone&debug=debug&task=nli}}
\newcommand{\tagstr}{control code\xspace}
\newcommand{\Tagstr}{Control code\xspace}
\newcommand{\tagstrs}{control codes\xspace}
\newcommand{\tagstrshorts}{codes\xspace}
\newcommand{\tagstrshort}{code\xspace}


\newcommand{\cmark}{{\ding{51}}}%
\newcommand{\xmark}{{\ding{55}}}%
\newcommand{\qmark}{{\textbf{\textsf{?}}}}%

\newcommand{\perturbtoken}{\texttt{<|perturb|>}\xspace}%
\newcommand{\stoptoken}{\texttt{[SEP]}\xspace}%



\newcommand{\eg}{\emph{e.g.,}\xspace}%
\newcommand{\ie}{\emph{i.e.,}\xspace}

% tasks
\newcommand{\nli}{\emph{NLI}\xspace}
\newcommand{\sst}{\emph{Sentiment}\xspace}
\newcommand{\qqp}{\emph{QQP}\xspace}

\def \dsst{SST-2\xspace}
\def \dqqp{QQP\xspace}
\def \dnli{SNLI\xspace}


\newcommand{\xp}{\hat{x}}
\newcommand{\yp}{\hat{y}}
\newcommand{\xset}{\mathbf{X}}
\newcommand{\tofix}[1]{{\color{red}#1}\xspace}


% annotations
\newcommand{\ensuretext}[1]{#1}
\newcommand{\marker}[2]{\ensuremath{^{\textsc{#1}}_{\textsc{#2}}}}
\newcommand{\arkcomment}[3]{\ensuretext{\textcolor{#3}{[#1 #2]}}}
%\renewcommand{\arkcomment}[3]{}  % uncomment for submission
\newcommand{\hao}[1]{\arkcomment{\marker{H}{P}}{#1}{purple}}
\newcommand{\wts}[1]{\arkcomment{\marker{S}{W}}{#1}{orange}}
\newcommand{\victor}[1]{\arkcomment{\marker{V}{Z}}{#1}{blue}}
\newcommand{\dq}[1]{\arkcomment{\marker{D}{Q}}{#1}{cyan}}
\newcommand{\dan}[1]{\arkcomment{\marker{D}{W}}{#1}{red}}

% teal, cyan
%\title{\sysname: General-purpose Counterfactual Generation}
\title{\sysname: Generating Counterfactuals \\for Explaining, Evaluating, and Improving Models}


\author{
\makecell{
Tongshuang Wu$^{1}$ ~~~~~~~ 
Marco Tulio Ribeiro$^{2}$ ~~~~~~~ 
Jeffrey Heer$^{1}$ ~~~~~ 
Daniel S. Weld$^{1,3}$}  \\ 
$^{1}$University of Washington\hspace{5mm}
$^{2}$Microsoft Research\hspace{5mm} 
$^{3}$Allen Institute for Artificial Intelligence\hspace{5mm}\\
\hspace{-5mm}
\href{mailto:wtshuang@cs.uw.edu}{\texttt {wtshuang@cs.uw.edu}}
\hspace{5mm}
\href{mailto:marcotcr@microsoft.com}{\texttt {marcotcr@gmail.com}}
\hspace{10mm}
\href{mailto:dan@cs.washington.edu}{\texttt {\{jheer,weld\}@cs.uw.edu}}
}


\date{}

\begin{document}
\maketitle
\begin{abstract}


While counterfactual examples
%(or perturbations) \dq{} 
are useful for analysis and training of NLP models, current generation methods either rely on manual labor to create very few counterfactuals, or 
%only instantiate a small set of automatic perturbations such as paraphrases or word substitutions.
only instantiate limited types of perturbations such as paraphrases or word substitutions. %, lacking variety.
We present \sysname, a general-purpose counterfactual generator that allows for control over perturbation types and locations, trained by finetuning GPT-2 on multiple datasets of paired sentences. 
We show that \sysname produces diverse sets of realistic counterfactuals, which in turn are useful in various distinct applications: improving training and evaluation on three different tasks (with up to 75\% less annotation effort than manual generation), augmenting state-of-the-art explanation techniques, and supporting systematic counterfactual error analysis that reveals behaviors easily missed by human experts.

% Counterfactual examples are useful for various applications, but current methods for generating them either rely on crowdsourcing, or only instantiate a small set of possible perturbations-of-interest (\eg changing the groundtruth label through a single antonym substitution.)
% We propose \sysname, a general purpose counterfactual generator, by finetuning GPT-2 on multiple datasets with paired sentences. 
% \sysname allows control over the type and location of perturbations, and therefore more comprehensively cover desired counterfactuals.
% We show that \sysname produces a diverse set of fluent counterfactuals, and that simple selection mechanisms make it useful for training and evaluation (up to 75\% less annotation effort compared to manual creation), augments state-of-the-art explanation techniques, and supports counterfactual error analysis by revealing erroneous model behaviors that are easily missed by human analysts.


%Counterfactual examples have been shown to be useful for many applications, including calibrating, evaluating, and explaining model decision boundaries. 
%However, previous methods for generating such counterfactuals have been tightly tailored to a specific application, used a limited range of linguistic patterns, or are hard to scale. 
%We propose to disentangle counterfactual generation from its use cases, \ie gather general-purpose counterfactuals first, and then select them for specific applications. 
%We frame the automated counterfactual generation as text generation, and finetune GPT-2 into a generator, \sysname, which produces fluent and diverse counterfactuals. 
%Our method also allows control over where perturbations happen and what they do. 
%We show \sysname supports multiple use cases: 
%When creating datasets for model training and evaluation, \sysname helps to save up to 75\% annotation efforts over manual creation.
%When used to produce explanations and for error analysis, \sysname reveals erroneous model behaviors that are easily missed by human analysts.



%
%Existing methods generate counterfactual examples for specific applications, even though most of the examples can be broadly used for calibrating, evaluating, and explaining model decision boundaries. 
%Constrained by their use cases, the methods each have a limited linguistic pattern coverage or are hard to scale. 
%We propose to disentangle the generation from the use cases, \ie, gather general-purpose counterfactuals first, and then select them for specific applications. 
%We frame the automated counterfactual generation as text generation, and finetune GPT-2 into a generator, \sysname, which produces fluent and diverse counterfactuals. 
%It also allows control over where perturbations happen and what they do. With effective selections, we show \sysname supports multiple use cases: by generating diverse counterfactuals for humans to label, \sysname helps produce high-quality datasets for model training and evaluation, with at least 40\% less human effort. 
%As counterfactual explanations, \sysname helps reveal erroneous model behaviors on top of popular feature attribution methods. 
\end{abstract}

\input{sections/intro}
\input{sections/model}

\input{sections/use_label}
\input{sections/use_explanation}
\input{sections/use_err_analysis}

\input{sections/relate}
\input{sections/discussion}
\input{sections/ethical}
%\input{sections/ack}
\bibliography{ref}
\bibliographystyle{acl_natbib}

\clearpage
\newpage

\appendix
\input{sections/app_train_datasets}
%\input{sections/app_survey}

\input{sections/app_augmentation}
\input{sections/app_explanation}
\input{sections/app_err_analysis}

%\balance
%\input{sections/app_examples}

\end{document}
